La GUI es la Parte Fácil
------------------------


Empezar a crear la interfaz gráfica de una aplicación es como empezar a escribir
un libro. Tenés un espacio en blanco, esperando que hagas algo, y si no sabés
qué es lo que querés poner ahí, la infinitud de los caminos que se te abren
es paralizante.

Este capítulo no te va a ayudar en absoluto con ese problema, si no que vamos
a tratar de resolver su opuesto: sabiendo qué querés hacer, cómo se hace?

Vamos a aprender a hacer programas sencillos usando PyQt, un toolkit de
interfaz gráfica potente, multiplataforma, y relativamente sencillo de usar.

Proyecto
~~~~~~~~

Vamos a hacer una aplicación completa. Como esto es un libro de Python y no
específicamente de PyQt, no va a ser *tan* complicada. Veamos un escenario para
entender de dónde viene este proyecto.

Supongamos que estás usando tu computadora y querés escuchar música. Supongamos
también que te gusta escuchar radios online.

Hoy en día hay varias maneras de hacerlo:

* Ir al sitio de la radio.
* Utilizar un reproductor de medios (Amarok, Banshee, Media Player o similar)
* Usar `RadioTray <http://radiotray.sf.net>`_

Resulta que mi favorita es la tercera opción por varios motivos que no vienen al
caso. Nuestro proyecto es crear una aplicación similar, minimalista y fácil de
entender.

Programación con Eventos
~~~~~~~~~~~~~~~~~~~~~~~~

Signals / Slots
~~~~~~~~~~~~~~~

Ventanas / Diálogos
~~~~~~~~~~~~~~~~~~~

Radiotray tiene exactamente dos ventanas [#]_:

.. figure:: radio-1.print.jpg
   :width: 63%

   El diálogo de administración de radios y el de añadir radio.

.. [#] Bueno, mentira, tienen también  una ventana "Acerca de"

No creo en hacer ventanas a mano. Creo que acomodar los widgets en el
lugar adonde van es un problema resuelto, y la solución es usar un
diseñador de diálogos. [#]_

.. [#] Sí, ya sé, "no tenés el mismo control". Tampoco tengo mucho
       control sobre la creación de la pizzanesa a la española en La
       Farola de San Isidro, pero si alguna vez la comiste sabés que
       eso es lo de menos.

En nuestro caso, como estamos usando PyQt, la herramienta es Qt
Designer [#].

.. [#] Lamentablemente una *buena* explicación de Designer requiere
       videos y mucho más detalle del que puedo incluir en un
       capítulo, pero vamos a tratar de ver lo importante, sin
       quedarnos en cómo se hace cada cosa exactamente.

.. figure:: radio-2.print.jpg
   :width: 100%

   Designer a punto de crear un diálogo vacío.

El proceso de crear una interfaz en Designer tiene varios pasos.
Sabiendo qué interfaz queremos [#]_, el primero es acomodar más o menos
a ojo los objetos deseados.

.. [#] En nuestro caso, como estamos robando, es muy sencillo. En la
       vida real, este trabajo se basaría en wireframing, o algún
       otro proceso de creación de interfaces.

.. figure:: radio-3.print.jpg
   :width: 40%

   El primer borrador.

   Literalmente, tomé unos botones y una lista y los tiré adentro de la
   ventana más o menos en posición.

El acomodarlos muy así nomás es intencional, porque el siguiente paso
es usar *Layout Managers* para que los objetos queden bien acomodados.
En una GUI moderna **no tiene sentido** acomodar las cosas en posiciones
absolutas, porque no tenés idea de como va a ser la interfaz para el
usuario final con tanto nivel de detalle. Por ejemplo:

* Traducciones a otros idiomas hacen que los botones deban ser más
  anchos o angostos.

* Cambios en la tipografía del sistema pueden hacer que sean más altos
  o bajos.

* Cambios en el estilo de widgets, o en la plataforma usada pueden
  cambiar la forma misma de un botón (¿más redondeado? ¿más plano?)

Dadas todas esas variables, es nuestro trabajo hacer un layout que
funcione con todas las combinaciones posibles, que sea flexible y
responda a esos cambios con gracia.

En nuestro caso, podríamos imponer las siguientes "restricciones" a
las posiciones de los widgets:

* El botón de "Cerrar" va abajo a la derecha.

* Los otros botones van en una columna a la derecha de la lista,
  en la parte de arriba de la ventana.

* La lista va a la izquierda de los botones.

Veamos por partes.

Los botones se agrupan con un "Vertical Layout", para que queden
alineados y en columna. Los seleccionamos todos usando Ctrl+click y
apretamos el botón de "vertical layout" en la barra de herramientas:

.. figure:: radio-4.print.jpg
   :width: 40%

   El layout vertical de botones se ve como un recuadro rojo.

Un layout vertical solo hace que los objetos que contiene queden en
una columna. Todos tienen el mismo ancho y están espaciados
regularmente.

Para que los botones queden al lado de la lista, seleccionamos *el layout*
y la lista, y hacemos un layout horizontal:

.. figure:: radio-5.print.jpg
   :width: 40%

   ¡Layouts anidados!

El layout horizontal hace exactamente lo mismo que el vertical, pero
en vez de una columna forman una fila.

Por último, deberíamos hacer un layout vertical conteniendo el layout
horizontal que acabamos de crear y el botón que nos queda.

Como ese layout es el "top level" y tiene que cubrir toda la ventana,
se hace ligeramente distinto: botón derecho en el fondo de la ventana
y "Lay out" -> "Lay Out Vertically":

.. figure:: radio-6.print.jpg
   :width: 40%

   ¡Feo!

Si bien el resultado cumple las cosas que habíamos definido, es
horrible:

* El botón de cerrar cubre todo el fondo de la ventana.
* El espaciado de los otros botones es antinatural.

La solución en ambos casos es el uso de espaciadores, que "empujen"
el botón de abajo hacia la derecha (luego de meterlo en un layout
horizontal) y los otros hacia arriba:

.. figure:: radio-7.print.jpg
   :width: 40%

   ¡Mejor!
    
Por supuesto que hay más de una solución para cada problema de cómo
acomodar widgets:

.. figure:: radio-8.print.jpg
   :width: 40%

   ¿Mejor o peor que la anterior? ¡Vean el capítulo siguiente!

El siguiente paso es poner textos [#]_, iconos [#]_, y nombres de objetos
para que la interfaz empiece a parecer algo útil.

.. [#] Sí, estoy haciendo la interfaz en inglés. Después vamos a ver
       como traducirla al castellano. Si la hacés directamente en
       castellano te estás encerrando en un nicho (por lo menos si
       la aplicación es software libre, como esta).

.. [#] Yo uso los `iconos de Reinhardt <http://kde-look.org/content/show.php?content=6153>`_:
       me gustan estéticamente, son minimalistas y se ven igual de
       raros en todos los sistemas operativos. Si querés usar otros,
       hay millones de iconos gratis dando vueltas. Es cuestión de
       ser consistente (¡y fijarse la licencia!)

Los iconos se van a cargar en un *archivo de recursos*, ``icons.qrc``:

.. code-block:: xml
   :include: codigo/5/icons.qrc

Ese archivo se compila para generar un módulo python con todas las
imágenes en su interior. Eso simplifica el deployment.

::

    [codigo/5]$ pyrcc4 icons.qrc -o icons_rc.py
    [codigo/5]$ ls -lth icons_rc.py
    -rw-r--r-- 1 ralsina users 58K Apr 30 10:14 icons_rc.py

El diálogo en sí está definido en el archivo ``radio.ui``, y se ve de
esta manera:

.. figure:: radio-9.print.jpg
   :width: 40%

   Nuestro clon.

El otro diálogo es mucho más simple, y no voy a mostrar el proceso de
layout, pero tiene un par de peculiaridades.

Buddies
    Cuando se tiene una pareja etiqueta/entrada (por ejemplo,
    "Radio Name:" y el widget donde se ingresa), hay que poner
    el atajo de teclado en la etiqueta. Para eso se usan "buddies".

    Se elije el modo "Edit Buddies" del designer y se marca la
    etiqueta y luego el widget de ingreso de datos. De esa forma,
    el atajo de teclado elegido para la etiqueta activa el
    widget.

.. figure:: radio-10.print.jpg
   :width: 45%

Tab Order
    ¿En qué orden se pasa de un widget a otro usando Tab? Es
    importante que se siga un orden lógico acorde a lo que se ve
    en pantalla y no andar saltando de un lado para otro sin
    una lógica visible.

    Se hace en el modo "Edit Tab Order" de designer.

.. figure:: radio-11.print.jpg
   :width: 45%

Signals/Slots
    Los diálogos tienen métodos ``accept`` y ``reject`` que coinciden
    con el objetivo obvio de los botones. ¡Entonces conectémoslos!

    En el modo "Edit Signals/Slots" de designer, se hace click en
    el botón y luego en el diálogo en sí, y se elige qué se conecta.

.. figure:: radio-12.print.jpg
   :width: 45%

   Son similares. ¡Hasta tienen algunos problemas similares!

Pasemos a una comparativa lado a lado de los objetos
terminados:

.. figure:: radio-13.print.jpg
   :width: 90% 

Acciones
~~~~~~~~

